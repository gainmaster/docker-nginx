#!/usr/bin/env bash

# Script to start nginx
# Takes -p or --path as parameter
# Defaults to /srv/http if provided path
# does not exist.

set -e

# Set defaults
CONFIG_PATH='/etc/nginx/sites-enabled/default'
ROOT_PATH='/srv/http/'

OPTS=`getopt -o p: --long path: -n 'parse-options' -- "$@"`
if [ $? != 0 ] ; then echo "Failed parsing options." >&2 ; exit 1 ; fi
 
eval set -- "$OPTS"

while true ; do
    case "$1" in
        -p | --path ) if [ -d "$ROOT_PATH" ]; then ROOT_PATH="$2"; fi; shift ;;
        -- ) shift; break ;;
        *  ) break ;;
    esac
done

# Write config
sed -i "6s|.*|root $ROOT_PATH;|" "$CONFIG_PATH"

# Start NGINX
echo "Starting NGINX with root path $ROOT_PATH"
/usr/sbin/nginx > /tmp/nginx.log
